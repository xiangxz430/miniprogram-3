<!-- pages/user_profile/index.wxml -->
<view class="container">
  <!-- ä¸ªäººèµ„æ–™å¤´éƒ¨ -->
  <view class="profile-header">
    <view class="avatar-container">
      <view class="avatar" wx:if="{{userInfo.avatar}}">
        <image src="{{userInfo.avatar}}" mode="aspectFill"></image>
      </view>
      <view class="avatar avatar-default" wx:else>{{userInfo.firstLetter}}</view>
    </view>
    <view class="user-info">
      <!-- éç¼–è¾‘çŠ¶æ€æ˜¾ç¤ºæ˜µç§° -->
      <text class="nickname" wx:if="{{!isEditing}}">{{userInfo.nickname}}</text>
      <!-- ç¼–è¾‘çŠ¶æ€æ˜¾ç¤ºè¾“å…¥æ¡† -->
      <input wx:else class="nickname-input" type="text" value="{{userInfo.nickname}}" bindinput="inputNickname" placeholder="è¯·è¾“å…¥æ˜µç§°" maxlength="10"/>
      <text class="user-description">{{userInfo.zodiac}} Â· {{userInfo.mbti}} Â· {{userInfo.lunarDate}}</text>
    </view>
    <!-- æ·»åŠ é¡¶éƒ¨ç¼–è¾‘æŒ‰é’® -->
    <view class="edit-btn-header" bindtap="toggleEditMode">
      <text>{{isEditing ? 'ä¿å­˜' : 'ç¼–è¾‘'}}</text>
    </view>
  </view>
  
  <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
  <view class="tabs-container">
    <view class="tabs">
      <view wx:for="{{tabItems}}" wx:key="index" class="tab {{activeTab === item.index ? 'active' : ''}}" catchtap="switchTab" data-index="{{item.index}}">{{item.text}}</view>
    </view>
    
    <!-- ä¸ªäººä¿¡æ¯å†…å®¹ -->
    <view class="tab-content" wx:if="{{activeTab === 0}}">
      <!-- ä»Šæ—¥æ€»è§ˆ
      <view class="section">
        <view class="section-title">ä»Šæ—¥æ€»è§ˆ</view>
        
        <view class="overview-cards">
          <view class="profile-card blue-gradient">
            <view class="card-inner">
              <view class="card-icon icon-bg-blue">
                <text class="iconfont icon-hexagram"></text>
              </view>
              <view class="card-content">
                <text class="card-label">ä»Šæ—¥å¦è±¡</text>
                <text class="card-value">{{dailyData.hexagram.name}} Â· {{dailyData.hexagram.description}}</text>
              </view>
            </view>
          </view>
          
          <view class="profile-card yellow-gradient">
            <view class="card-inner">
              <view class="card-icon icon-bg-yellow">
                <text class="iconfont icon-star"></text>
              </view>
              <view class="card-content">
                <text class="card-label">ä»Šæ—¥è¿åŠ¿</text>
                <text class="card-value">
                  <text wx:for="{{dailyData.horoscope.rating}}" wx:key="index" class="star">â˜…</text>
                  <text wx:for="{{5 - dailyData.horoscope.rating}}" wx:key="index" class="star-empty">â˜†</text>
                </text>
              </view>
            </view>
          </view>
        </view>
      </view>
       -->
      <!-- åŸºç¡€ä¿¡æ¯ -->
      <view class="section">
        <view class="section-header">
          <text class="section-title">åŸºç¡€ä¿¡æ¯</text>
          <text class="edit-btn" bindtap="toggleEditMode">{{isEditing ? 'ä¿å­˜' : 'ç¼–è¾‘'}}</text>
        </view>
        <view class="info-list">
          <view class="info-item">
            <view class="info-label">
              <view class="info-icon">
                <text class="iconfont icon-calendar"></text>
              </view>
              <text>ç”Ÿæ—¥</text>
            </view>
            <view wx:if="{{!isEditing}}" class="info-value">{{userInfo.birthdate}}</view>
            <picker wx:else mode="date" value="{{userInfo.birthdate}}" start="1900-01-01" end="2030-12-31" bindchange="bindBirthdateChange" class="picker-input">
              <view class="info-value editing">{{userInfo.birthdate}}</view>
            </picker>
          </view>
          
          <!-- æ·»åŠ å‡ºç”Ÿæ—¶é—´å­—æ®µ -->
          <view class="info-item">
            <view class="info-label">
              <view class="info-icon">
                <text class="iconfont icon-time"></text>
              </view>
              <text>å‡ºç”Ÿæ—¶é—´</text>
            </view>
            <view wx:if="{{!isEditing}}" class="info-value">{{userInfo.birthtime || 'æœªè®¾ç½®'}}</view>
            <picker wx:else mode="time" value="{{userInfo.birthtime}}" bindchange="bindBirthtimeChange" class="picker-input">
              <view class="info-value editing">{{userInfo.birthtime || 'è¯·é€‰æ‹©å‡ºç”Ÿæ—¶é—´'}}</view>
            </picker>
          </view>
          
          <!-- æ·»åŠ æ€§åˆ«å­—æ®µ -->
          <view class="info-item">
            <view class="info-label">
              <view class="info-icon">
                <text class="iconfont icon-gender"></text>
              </view>
              <text>æ€§åˆ«</text>
            </view>
            <view wx:if="{{!isEditing}}" class="info-value">{{userInfo.gender || 'æœªè®¾ç½®'}}</view>
            <picker wx:else mode="selector" range="{{genderOptions}}" value="{{genderIndex}}" bindchange="bindGenderChange" class="picker-input">
              <view class="info-value editing">{{userInfo.gender || 'è¯·é€‰æ‹©æ€§åˆ«'}}</view>
            </picker>
          </view>
          
          <view class="info-item">
            <view class="info-label">
              <view class="info-icon">
                <text class="iconfont icon-moon"></text>
              </view>
              <text>å†œå†</text>
            </view>
            <text class="info-value">{{userInfo.lunarDate}}</text>
          </view>
          
          <view class="info-item">
            <view class="info-label">
              <view class="info-icon">
                <text class="iconfont icon-zodiac"></text>
              </view>
              <text>æ˜Ÿåº§</text>
            </view>
            <text class="info-value">{{userInfo.zodiac}}</text>
          </view>
          
          <view class="info-item">
            <view class="info-label">
              <view class="info-icon">
                <text class="iconfont icon-mbti"></text>
              </view>
              <text>MBTI</text>
            </view>
            <view wx:if="{{!isEditing}}" class="info-value">{{userInfo.mbti}}</view>
            <picker wx:else bindchange="bindMBTIChange" value="{{mbtiIndex}}" range="{{mbtiOptions}}" class="picker-input">
              <view class="info-value editing">{{userInfo.mbti}}</view>
            </picker>
          </view>

          <view class="info-item">
            <view class="info-label">
              <view class="info-icon">
                <text class="iconfont icon-location"></text>
              </view>
              <text>å‡ºç”Ÿåœ°</text>
            </view>
            <view wx:if="{{!isEditing}}" class="info-value">{{userInfo.birthplace || 'æœªè®¾ç½®'}}</view>
            <picker wx:else mode="region" value="{{userInfo.birthplaceArray}}" bindchange="bindBirthplaceChange" class="picker-input">
              <view class="info-value editing">{{userInfo.birthplace || 'è¯·é€‰æ‹©å‡ºç”Ÿåœ°'}}</view>
            </picker>
          </view>

          <view class="info-item">
            <view class="info-label">
              <view class="info-icon">
                <text class="iconfont icon-location"></text>
              </view>
              <text>å½“å‰ä½ç½®</text>
            </view>
            <view class="info-value-row">
              <text class="info-value" wx:if="{{userInfo.currentLocation}}">{{userInfo.currentLocation}}</text>
              <text class="info-value" wx:else style="color: #999;">ç‚¹å‡»è®¾ç½®ä½ç½®</text>
              <text class="location-btn" bindtap="getLocation">{{userInfo.currentLocation ? 'æ›´æ–°' : 'è®¾ç½®'}}</text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- è®¾ç½®èœå• -->
      <view class="section">
        <view class="section-title">è®¾ç½®</view>
        
        <view class="settings-list">
          <!-- åˆå§‹åŒ–æ•°æ®åº“æŒ‰é’®ï¼ˆè°ƒè¯•ç”¨ï¼‰ -->
          <view class="setting-item debug-item" bindtap="initializeDatabase">
            <view class="setting-label">
              <view class="setting-icon debug-icon">
                <text class="iconfont icon-database"></text>
              </view>
              <text class="setting-text debug-text">åˆå§‹åŒ–æ•°æ®åº“ï¼ˆè°ƒè¯•ç”¨ï¼‰</text>
            </view>
            <view class="setting-arrow"></view>
          </view>
          
          <view class="setting-item" bindtap="goToSettings" data-type="é€šçŸ¥">
            <view class="setting-label">
              <view class="setting-icon">
                <text class="iconfont icon-notification"></text>
              </view>
              <text class="setting-text">é€šçŸ¥è®¾ç½®</text>
            </view>
            <view class="setting-arrow"></view>
          </view>
          
          <view class="setting-item" bindtap="goToSettings" data-type="éšç§">
            <view class="setting-label">
              <view class="setting-icon">
                <text class="iconfont icon-privacy"></text>
              </view>
              <text class="setting-text">éšç§è®¾ç½®</text>
            </view>
            <view class="setting-arrow"></view>
          </view>
          
          <view class="setting-item" bindtap="goToSettings" data-type="ä¸»é¢˜">
            <view class="setting-label">
              <view class="setting-icon">
                <text class="iconfont icon-theme"></text>
              </view>
              <text class="setting-text">ä¸»é¢˜è®¾ç½®</text>
            </view>
            <view class="setting-arrow"></view>
          </view>
          
          <view class="setting-item" bindtap="goToSettings" data-type="å¸®åŠ©ä¸åé¦ˆ">
            <view class="setting-label">
              <view class="setting-icon">
                <text class="iconfont icon-help"></text>
              </view>
              <text class="setting-text">å¸®åŠ©ä¸åé¦ˆ</text>
            </view>
            <view class="setting-arrow"></view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- é«˜çº§åŠŸèƒ½å†…å®¹ -->
    <view class="tab-content" wx:if="{{activeTab === 1}}">
      <!-- åˆ†æåŠŸèƒ½ -->
      <view class="section">
        <view class="section-title">ä¸ªäººæ•°æ®åˆ†æ</view>
        
        <!-- å½“æ²¡æœ‰å…«å­—ä¿¡æ¯æ—¶æ˜¾ç¤ºè¾“å…¥è¡¨å• -->
        <view class="bazi-form" wx:if="{{!baziAnalysisResult}}">
          <view class="form-description">
            <text class="description-text">è¯·è¾“å…¥å‡†ç¡®çš„å‡ºç”Ÿä¿¡æ¯ï¼Œæˆ‘ä»¬å°†ç”¨ä¼ç¾²å¤§æ¨¡å‹ä¸ºæ‚¨è¿›è¡Œä¸“ä¸šçš„åˆ†æ</text>
          </view>
          
          <view class="form-group">
            <text class="form-label">å§“å</text>
            <input class="form-input-text" type="text" value="{{baziForm.name}}" bindinput="onBaziNameChange" placeholder="è¯·è¾“å…¥å§“å" maxlength="10"/>
          </view>
          
          <view class="form-group">
            <text class="form-label">å‡ºç”Ÿæ—¥æœŸ</text>
            <picker mode="date" value="{{baziForm.birthDate}}" start="1900-01-01" end="2030-12-31" bindchange="onBaziBirthDateChange">
              <view class="form-input">{{baziForm.birthDate || 'è¯·é€‰æ‹©å‡ºç”Ÿæ—¥æœŸ'}}</view>
            </picker>
          </view>
          
          <view class="form-group">
            <text class="form-label">å‡ºç”Ÿæ—¶é—´</text>
            <picker mode="time" value="{{baziForm.birthTime}}" bindchange="onBaziBirthTimeChange">
              <view class="form-input">{{baziForm.birthTime || 'è¯·é€‰æ‹©å‡ºç”Ÿæ—¶é—´'}}</view>
            </picker>
          </view>
          
          <view class="form-group">
            <text class="form-label">æ€§åˆ«</text>
            <picker mode="selector" range="{{['ç”·', 'å¥³']}}" value="{{baziForm.genderIndex}}" bindchange="onBaziGenderChange">
              <view class="form-input">{{baziForm.gender || 'è¯·é€‰æ‹©æ€§åˆ«'}}</view>
            </picker>
          </view>
          
          <view class="form-group">
            <text class="form-label">å‡ºç”Ÿåœ°</text>
            <picker mode="region" value="{{baziForm.birthplaceArray}}" bindchange="onBaziBirthplaceChange">
              <view class="form-input">{{baziForm.birthplace || 'è¯·é€‰æ‹©å‡ºç”Ÿåœ°'}}</view>
            </picker>
          </view>
          
          <button class="calculate-bazi-btn" bindtap="calculateBazi" disabled="{{!canCalculateBazi || isCalculatingBazi}}">
            {{isCalculatingBazi ? 'åˆ†æä¸­...' : 'å¼€å§‹å…«å­—åˆ†æ'}}
          </button>
        </view>
        
        <!-- å…«å­—åˆ†æç»“æœæ˜¾ç¤º -->
        <view class="bazi-result" wx:if="{{baziAnalysisResult}}">
          <!-- å…«å­—æ’ç›˜ -->
          <view class="bazi-panel">
            <view class="panel-title">å…«å­—æ’ç›˜</view>
            <view class="bazi-pillars">
              <view class="pillar">
                <text class="pillar-label">å¹´æŸ±</text>
                <text class="pillar-value">{{baziAnalysisResult.baziInfo.year}}</text>
              </view>
              <view class="pillar">
                <text class="pillar-label">æœˆæŸ±</text>
                <text class="pillar-value">{{baziAnalysisResult.baziInfo.month}}</text>
              </view>
              <view class="pillar">
                <text class="pillar-label">æ—¥æŸ±</text>
                <text class="pillar-value">{{baziAnalysisResult.baziInfo.day}}</text>
              </view>
              <view class="pillar">
                <text class="pillar-label">æ—¶æŸ±</text>
                <text class="pillar-value">{{baziAnalysisResult.baziInfo.hour}}</text>
              </view>
            </view>
            <view class="day-master-info">
              <text class="day-master-label">æ—¥ä¸»ï¼š</text>
              <text class="day-master-value">{{baziAnalysisResult.baziInfo.dayMaster}}ï¼ˆ{{baziAnalysisResult.baziInfo.dayMasterElement}}ï¼‰</text>
            </view>
          </view>
          
          <!-- äº”è¡Œåˆ†æ -->
          <view class="wuxing-analysis">
            <view class="panel-title">äº”è¡Œåˆ†æ</view>
            <view class="wuxing-distribution">
              <view class="wuxing-item" wx:for="{{wuxingItems}}" wx:key="element">
                <text class="wuxing-name">{{item.name}}</text>
                <view class="wuxing-bar">
                  <view class="wuxing-fill" style="width: {{item.percentage}}%; background-color: {{item.color}}"></view>
                </view>
                <text class="wuxing-count">{{item.count}}</text>
              </view>
            </view>
            <view class="wuxing-details">
              <view class="detail-item">
                <text class="detail-label">æ ¼å±€ï¼š</text>
                <text class="detail-value">{{baziAnalysisResult.wuxingAnalysis.pattern}}</text>
              </view>
              <view class="detail-item">
                <text class="detail-label">å¼ºå¼±ï¼š</text>
                <text class="detail-value">{{baziAnalysisResult.wuxingAnalysis.strength}}</text>
              </view>
              <view class="detail-item">
                <text class="detail-label">ç”¨ç¥ï¼š</text>
                <text class="detail-value">{{baziAnalysisResult.wuxingAnalysis.usefulGod}}</text>
              </view>
              <view class="detail-item">
                <text class="detail-label">å¿Œç¥ï¼š</text>
                <text class="detail-value">{{baziAnalysisResult.wuxingAnalysis.tabooGod}}</text>
              </view>
            </view>
          </view>
          
          <!-- å§“åè§£æåˆ†æ -->
          <view class="name-analysis-section" wx:if="{{baziAnalysisResult.nameAnalysis}}">
            <view class="panel-title">å§“åè§£æ</view>
            
            <!-- å§“åäº”æ ¼ -->
            <view class="name-breakdown-panel">
              <view class="breakdown-title">äº”æ ¼å‰–è±¡</view>
              <view class="breakdown-grid">
                <view class="breakdown-item">
                  <text class="breakdown-label">å¤©æ ¼</text>
                  <text class="breakdown-value">{{baziAnalysisResult.nameAnalysis.nameBreakdown.tianGe}}</text>
                </view>
                <view class="breakdown-item">
                  <text class="breakdown-label">äººæ ¼</text>
                  <text class="breakdown-value">{{baziAnalysisResult.nameAnalysis.nameBreakdown.renGe}}</text>
                </view>
                <view class="breakdown-item">
                  <text class="breakdown-label">åœ°æ ¼</text>
                  <text class="breakdown-value">{{baziAnalysisResult.nameAnalysis.nameBreakdown.diGe}}</text>
                </view>
                <view class="breakdown-item">
                  <text class="breakdown-label">å¤–æ ¼</text>
                  <text class="breakdown-value">{{baziAnalysisResult.nameAnalysis.nameBreakdown.waiGe}}</text>
                </view>
                <view class="breakdown-item">
                  <text class="breakdown-label">æ€»æ ¼</text>
                  <text class="breakdown-value">{{baziAnalysisResult.nameAnalysis.nameBreakdown.zongGe}}</text>
                </view>
              </view>
            </view>
            
            <!-- å§“åäº”è¡Œ -->
            <view class="name-wuxing-panel">
              <view class="wuxing-title">å§“åäº”è¡Œ</view>
              <view class="name-wuxing-content">
                <view class="name-characters">
                  <text class="characters-label">å­—ç¬¦äº”è¡Œï¼š</text>
                  <view class="characters-tags">
                    <text class="character-tag" wx:for="{{baziAnalysisResult.nameAnalysis.nameWuxing.characters}}" wx:key="index">{{item}}</text>
                  </view>
                </view>
                <view class="name-overall-wuxing">
                  <text class="overall-label">æ•´ä½“äº”è¡Œï¼š</text>
                  <text class="overall-value">{{baziAnalysisResult.nameAnalysis.nameWuxing.overallWuxing}}</text>
                </view>
                <view class="name-balance">
                  <text class="balance-label">äº”è¡Œå¹³è¡¡ï¼š</text>
                  <text class="balance-value">{{baziAnalysisResult.nameAnalysis.nameWuxing.wuxingBalance}}</text>
                </view>
              </view>
            </view>
            
            <!-- å§“åä¸å…«å­—åŒ¹é…åº¦ -->
            <view class="name-match-panel">
              <view class="match-title">å…«å­—åŒ¹é…åº¦</view>
              <view class="match-content">
                <view class="match-score">
                  <text class="score-label">ç»¼åˆè¯„åˆ†ï¼š</text>
                  <text class="score-value name-score-{{baziAnalysisResult.nameAnalysis.nameScore >= 80 ? 'good' : baziAnalysisResult.nameAnalysis.nameScore >= 60 ? 'medium' : 'poor'}}">{{baziAnalysisResult.nameAnalysis.nameScore}}åˆ†</text>
                </view>
                <view class="compatibility-score">
                  <text class="compatibility-label">åŒ¹é…åº¦ï¼š</text>
                  <text class="compatibility-value match-score-{{baziAnalysisResult.nameAnalysis.baziNameMatch.compatibility >= 80 ? 'good' : baziAnalysisResult.nameAnalysis.baziNameMatch.compatibility >= 60 ? 'medium' : 'poor'}}">{{baziAnalysisResult.nameAnalysis.baziNameMatch.compatibility}}åˆ†</text>
                </view>
                <view class="match-analysis">
                  <text class="analysis-label">è¯¦ç»†åˆ†æï¼š</text>
                  <text class="analysis-text">{{baziAnalysisResult.nameAnalysis.baziNameMatch.analysis}}</text>
                </view>
                <view class="benefit-situation">
                  <text class="benefit-label">è¡¥ç›Šæƒ…å†µï¼š</text>
                  <text class="benefit-text">{{baziAnalysisResult.nameAnalysis.baziNameMatch.benefitSituation}}</text>
                </view>
              </view>
            </view>
            
            <!-- å§“åå»ºè®® -->
            <view class="name-advice-panel" wx:if="{{baziAnalysisResult.nameAdvice}}">
              <view class="advice-title">å§“åå»ºè®®</view>
              <view class="name-status">
                <text class="status-label">å§“åé€‚åˆåº¦ï¼š</text>
                <text class="status-value name-status-{{baziAnalysisResult.nameAdvice.isNameGood ? 'good' : 'poor'}}">{{baziAnalysisResult.nameAdvice.isNameGood ? 'é€‚åˆ' : 'éœ€è¦æ”¹è¿›'}}</text>
              </view>
              
              <view class="name-suggestions" wx:if="{{baziAnalysisResult.nameAdvice.suggestions.length > 0}}">
                <text class="suggestions-label">æ”¹è¿›å»ºè®®ï¼š</text>
                <view class="suggestions-list">
                  <text class="suggestion-item" wx:for="{{baziAnalysisResult.nameAdvice.suggestions}}" wx:key="index">â€¢ {{item}}</text>
                </view>
              </view>
              
              <view class="alternative-names" wx:if="{{baziAnalysisResult.nameAdvice.alternativeNames.length > 0}}">
                <text class="alternatives-label">æ¨èåå­—ï¼š</text>
                <view class="alternatives-tags">
                  <text class="alternative-tag" wx:for="{{baziAnalysisResult.nameAdvice.alternativeNames}}" wx:key="index">{{item}}</text>
                </view>
              </view>
            </view>
          </view>
          
          <!-- è¯¦ç»†åˆ†æ -->
          <view class="detailed-analysis">
            <view class="analysis-section">
              <view class="analysis-title">æ€§æ ¼ç‰¹å¾</view>
              <text class="analysis-content">{{baziAnalysisResult.personalityAnalysis}}</text>
            </view>
            
            <view class="analysis-section">
              <view class="analysis-title">äº‹ä¸šè´¢è¿</view>
              <text class="analysis-content">{{baziAnalysisResult.careerFortune}}</text>
            </view>
            
            <view class="analysis-section">
              <view class="analysis-title">å©šå§»æ„Ÿæƒ…</view>
              <text class="analysis-content">{{baziAnalysisResult.loveFortune}}</text>
            </view>
            
            <view class="analysis-section">
              <view class="analysis-title">å¥åº·è¿åŠ¿</view>
              <text class="analysis-content">{{baziAnalysisResult.healthFortune}}</text>
            </view>
            
            <view class="analysis-section">
              <view class="analysis-title">å¤§è¿æµå¹´</view>
              <view class="analysis-content">{{baziAnalysisResult.majorPeriods}}</view>
            </view>
          </view>
          
          <!-- å¼€è¿å»ºè®® -->
          <view class="lucky-advice">
            <view class="panel-title">å¼€è¿å»ºè®®</view>
            
            <view class="advice-grid">
              <view class="advice-item">
                <text class="advice-label">æœ‰åˆ©é¢œè‰²</text>
                <view class="advice-tags">
                  <text class="advice-tag" wx:for="{{baziAnalysisResult.luckyAdvice.colors}}" wx:key="index">{{item}}</text>
                </view>
              </view>
              
              <view class="advice-item">
                <text class="advice-label">æœ‰åˆ©æ–¹ä½</text>
                <view class="advice-tags">
                  <text class="advice-tag" wx:for="{{baziAnalysisResult.luckyAdvice.directions}}" wx:key="index">{{item}}</text>
                </view>
              </view>
              
              <view class="advice-item">
                <text class="advice-label">å¹¸è¿æ•°å­—</text>
                <view class="advice-tags">
                  <text class="advice-tag" wx:for="{{baziAnalysisResult.luckyAdvice.numbers}}" wx:key="index">{{item}}</text>
                </view>
              </view>
              
              <view class="advice-item">
                <text class="advice-label">è¡¥å……äº”è¡Œ</text>
                <view class="advice-tags">
                  <text class="advice-tag" wx:for="{{baziAnalysisResult.luckyAdvice.elements}}" wx:key="index">{{item}}</text>
                </view>
              </view>
            </view>
            
            <view class="suggestions">
              <text class="suggestions-title">å…·ä½“å»ºè®®ï¼š</text>
              <view class="suggestion-list">
                <text class="suggestion-item" wx:for="{{baziAnalysisResult.luckyAdvice.suggestions}}" wx:key="index">â€¢ {{item}}</text>
              </view>
            </view>
          </view>
          
          <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
          <view class="bazi-actions">
            <button class="recalculate-btn" bindtap="resetBaziAnalysis">é‡æ–°åˆ†æ</button>
            <button class="save-my-bazi-btn" bindtap="saveAsMyBazi">ä¿å­˜ä¸ºæˆ‘çš„å…«å­—</button>
            <button class="save-friend-btn" bindtap="saveAsFriend">ä¿å­˜ä¸ºæˆ‘çš„æœ‹å‹</button>
          </view>
        </view>
      </view>
    </view>
    
    <!-- å¥½å‹å†…å®¹ -->
    <view class="tab-content" wx:if="{{activeTab === 2}}">
      <!-- å¥½å‹ç®¡ç† -->
      <view class="section">
        <view class="section-header">
          <text class="section-title">å¥½å‹åˆ—è¡¨ ({{friends.length}})</text>
          <button class="add-friend-btn" catchtap="showAddFriendModal">
            <text class="iconfont icon-add-friend"></text>
            <text>æ·»åŠ å¥½å‹</text>
          </button>
        </view>
        
        <!-- å¥½å‹åˆ—è¡¨ -->
        <view class="friends-list" wx:if="{{friends.length > 0}}">
          <view class="friend-card" wx:for="{{friends}}" wx:key="index">
            <view class="friend-avatar {{item.bgColor}}">{{item.firstLetter}}</view>
            <view class="friend-info" catchtap="viewFriendDetail" data-index="{{index}}">
              <view class="friend-header">
                <text class="friend-name">{{item.name}}</text>
                <text class="friend-zodiac {{item.zodiacColor}}">{{item.zodiac}}</text>
              </view>
              <view class="friend-details">
                <text class="friend-mbti">{{item.mbti}} Â· {{item.lunarYear}}</text>
                <text class="friend-relation">{{item.relationship}}</text>
              </view>
              <view class="friend-extra-info">
                <text class="friend-birth">{{item.birthdate}} {{item.birthtime}}</text>
                <text class="friend-location">{{item.birthplace}}</text>
              </view>
            </view>
            <view class="friend-actions">
              <button class="friend-action-btn view-btn" catchtap="viewFriendBazi" data-index="{{index}}">
                <text class="iconfont icon-hexagram"></text>
                <text>å…«å­—</text>
              </button>
              <button class="friend-action-btn edit-btn" catchtap="editFriend" data-index="{{index}}">
                <text class="iconfont icon-edit"></text>
                <text>ç¼–è¾‘</text>
              </button>
              <button class="friend-action-btn delete-btn" catchtap="deleteFriend" data-index="{{index}}">
                <text class="iconfont icon-delete"></text>
                <text>åˆ é™¤</text>
              </button>
            </view>
          </view>
        </view>
        
        <!-- ç©ºçŠ¶æ€ -->
        <view class="empty-state" wx:else>
          <view class="empty-icon">ğŸ‘¥</view>
          <text class="empty-title">è¿˜æ²¡æœ‰å¥½å‹</text>
          <text class="empty-desc">æ·»åŠ å¥½å‹ï¼Œå¼€å§‹æ¢ç´¢å…«å­—åŒ¹é…çš„å¥¥ç§˜</text>
          <button class="empty-action-btn" catchtap="showAddFriendModal">ç«‹å³æ·»åŠ å¥½å‹</button>
          </view>
        </view>
      </view>
      
    <!-- å¥½å‹æ·»åŠ /ç¼–è¾‘æ¨¡æ€æ¡† -->
    <view class="modal-overlay" wx:if="{{showFriendModal}}" catchtap="hideFriendModal">
      <view class="modal-content" catchtap="preventModalClose">
        <view class="modal-header">
          <text class="modal-title">{{isEditingFriend ? 'ç¼–è¾‘å¥½å‹' : 'æ·»åŠ å¥½å‹'}}</text>
          <button class="modal-close-btn" catchtap="hideFriendModal">âœ•</button>
        </view>
        
        <view class="modal-body">
          <view class="form-group">
            <text class="form-label">å§“å</text>
            <input class="form-input-text" type="text" value="{{friendForm.name}}" bindinput="onFriendNameChange" placeholder="è¯·è¾“å…¥å¥½å‹å§“å" maxlength="10"/>
          </view>
          
          <view class="form-group">
            <text class="form-label">å‡ºç”Ÿæ—¥æœŸ</text>
            <picker mode="date" value="{{friendForm.birthDate}}" start="1900-01-01" end="2030-12-31" bindchange="onFriendBirthDateChange">
              <view class="form-input">{{friendForm.birthDate || 'è¯·é€‰æ‹©å‡ºç”Ÿæ—¥æœŸ'}}</view>
            </picker>
          </view>
          
          <view class="form-group">
            <text class="form-label">å‡ºç”Ÿæ—¶é—´</text>
            <picker mode="time" value="{{friendForm.birthTime}}" bindchange="onFriendBirthTimeChange">
              <view class="form-input">{{friendForm.birthTime || 'è¯·é€‰æ‹©å‡ºç”Ÿæ—¶é—´'}}</view>
            </picker>
          </view>
          
          <view class="form-group">
            <text class="form-label">æ€§åˆ«</text>
            <picker mode="selector" range="{{['ç”·', 'å¥³']}}" value="{{friendForm.genderIndex}}" bindchange="onFriendGenderChange">
              <view class="form-input">{{friendForm.gender || 'è¯·é€‰æ‹©æ€§åˆ«'}}</view>
            </picker>
              </view>
              
          <view class="form-group">
            <text class="form-label">å‡ºç”Ÿåœ°</text>
            <picker mode="region" value="{{friendForm.birthplaceArray}}" bindchange="onFriendBirthplaceChange">
              <view class="form-input">{{friendForm.birthplace || 'è¯·é€‰æ‹©å‡ºç”Ÿåœ°'}}</view>
            </picker>
              </view>
          
          <view class="form-group">
            <text class="form-label">å…³ç³»</text>
            <picker mode="selector" range="{{relationshipOptions}}" value="{{friendForm.relationshipIndex}}" bindchange="onFriendRelationshipChange">
              <view class="form-input">{{friendForm.relationship || 'è¯·é€‰æ‹©å…³ç³»'}}</view>
            </picker>
            </view>
          
          <view class="form-group">
            <text class="form-label">MBTI (å¯é€‰)</text>
            <picker mode="selector" range="{{mbtiOptions}}" value="{{friendForm.mbtiIndex}}" bindchange="onFriendMbtiChange">
              <view class="form-input">{{friendForm.mbti || 'è¯·é€‰æ‹©MBTIç±»å‹'}}</view>
            </picker>
          </view>
        </view>
        
        <view class="modal-footer">
          <button class="modal-btn cancel-btn" catchtap="hideFriendModal">å–æ¶ˆ</button>
          <button class="modal-btn confirm-btn" catchtap="saveFriend" disabled="{{!canSaveFriend}}">
            {{isEditingFriend ? 'ä¿å­˜' : 'æ·»åŠ '}}
          </button>
          </view>
        </view>
      </view>
      
    <!-- å¥½å‹è¯¦æƒ…æ¨¡æ€æ¡† -->
    <view class="modal-overlay" wx:if="{{showFriendDetailModal}}" catchtap="hideFriendDetailModal">
      <view class="friend-detail-modal" catchtap="preventModalClose">
        <view class="friend-detail-header">
          <view class="friend-detail-avatar {{selectedFriend.bgColor}}">{{selectedFriend.firstLetter}}</view>
          <view class="friend-detail-info">
            <text class="friend-detail-name">{{selectedFriend.name}}</text>
            <text class="friend-detail-zodiac {{selectedFriend.zodiacColor}}">{{selectedFriend.zodiac}}</text>
            <text class="friend-detail-relation">{{selectedFriend.relationship}}</text>
          </view>
          <button class="modal-close-btn" catchtap="hideFriendDetailModal">âœ•</button>
        </view>
        
        <view class="friend-detail-content">
          <view class="detail-section">
            <text class="detail-section-title">åŸºç¡€ä¿¡æ¯</text>
            <view class="detail-items">
              <view class="detail-item">
                <text class="detail-label">ç”Ÿæ—¥ï¼š</text>
                <text class="detail-value">{{selectedFriend.birthdate}}</text>
              </view>
              <view class="detail-item">
                <text class="detail-label">å‡ºç”Ÿæ—¶é—´ï¼š</text>
                <text class="detail-value">{{selectedFriend.birthtime}}</text>
            </view>
              <view class="detail-item">
                <text class="detail-label">æ€§åˆ«ï¼š</text>
                <text class="detail-value">{{selectedFriend.gender}}</text>
                </view>
              <view class="detail-item">
                <text class="detail-label">å‡ºç”Ÿåœ°ï¼š</text>
                <text class="detail-value">{{selectedFriend.birthplace}}</text>
                </view>
              <view class="detail-item">
                <text class="detail-label">MBTIï¼š</text>
                <text class="detail-value">{{selectedFriend.mbti}}</text>
              </view>
            </view>
          </view>
          
          <view class="detail-section" wx:if="{{selectedFriend.baziInfo}}">
            <text class="detail-section-title">å…«å­—ä¿¡æ¯</text>
            <view class="friend-bazi-panel">
              <view class="friend-bazi-pillars">
                <view class="friend-pillar">
                  <text class="friend-pillar-label">å¹´</text>
                  <text class="friend-pillar-value">{{selectedFriend.baziInfo.baziInfo.year}}</text>
              </view>
                <view class="friend-pillar">
                  <text class="friend-pillar-label">æœˆ</text>
                  <text class="friend-pillar-value">{{selectedFriend.baziInfo.baziInfo.month}}</text>
            </view>
                <view class="friend-pillar">
                  <text class="friend-pillar-label">æ—¥</text>
                  <text class="friend-pillar-value">{{selectedFriend.baziInfo.baziInfo.day}}</text>
                </view>
                <view class="friend-pillar">
                  <text class="friend-pillar-label">æ—¶</text>
                  <text class="friend-pillar-value">{{selectedFriend.baziInfo.baziInfo.hour}}</text>
                </view>
              </view>
              <view class="friend-day-master">
                <text class="friend-day-master-label">æ—¥ä¸»ï¼š</text>
                <text class="friend-day-master-value">{{selectedFriend.baziInfo.baziInfo.dayMaster}} ({{selectedFriend.baziInfo.baziInfo.dayMasterElement}})</text>
              </view>
            </view>
          </view>
        </view>
        
        <view class="friend-detail-actions">
          <button class="friend-detail-btn compatibility-btn" catchtap="calculateCompatibility" data-index="{{selectedFriendIndex}}">
            <text class="iconfont icon-wuxing"></text>
            <text>åŒ¹é…åˆ†æ</text>
          </button>
          <button class="friend-detail-btn edit-btn" catchtap="editFriendFromDetail" data-index="{{selectedFriendIndex}}">
            <text class="iconfont icon-edit"></text>
            <text>ç¼–è¾‘</text>
          </button>
          <button class="friend-detail-btn delete-btn" catchtap="deleteFriendFromDetail" data-index="{{selectedFriendIndex}}">
            <text class="iconfont icon-delete"></text>
            <text>åˆ é™¤</text>
          </button>
        </view>
      </view>
    </view>
  </view>
</view> 