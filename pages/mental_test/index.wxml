<!--å¿ƒç†å¥åº·æµ‹è¯•ä¸»é¡µé¢-->
<view class="mh-container">
  <!-- é¡¶éƒ¨HeroåŒºåŸŸ -->
  <view class="mh-hero">
    <view class="mh-hero-bg"></view>
    <view class="mh-hero-content">
      <view class="mh-hero-title">
        <text class="mh-hero-main">æ¢ç´¢å†…å¿ƒä¸–ç•Œ</text>
        <text class="mh-hero-sub">åŸºäºå›½é™…æ ‡å‡†å¿ƒç†æµ‹è¯„é‡è¡¨ï¼Œä¸“ä¸šå¿ƒç†å¥åº·è¯„ä¼°</text>
      </view>
      <view class="mh-hero-desc"> ä¸–ç•Œå«ç”Ÿç»„ç»‡ï¼ˆWHOï¼‰æ•°æ®è¡¨æ˜ï¼šä¸­å›½æŠ‘éƒç—‡å‘ç—…ç‡ä¸º3.02%ï¼Œç›®å‰å·²ç»æœ‰è¶…è¿‡4000ä¸‡æŠ‘éƒæ‚£è€…
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿæµ‹è¯•å…¥å£ -->
  <view class="mh-section">
    <view class="mh-section-header">
      <text class="mh-section-title">å¿«é€Ÿæµ‹è¯•</text>
      <text class="mh-section-subtitle">å‡ åˆ†é’Ÿäº†è§£ä½ çš„å¿ƒç†çŠ¶æ€</text>
    </view>
    <view class="mh-quick-tests">
      <view class="mh-quick-card" bindtap="startQuickTest" data-type="health">
        <view class="mh-quick-icon">ğŸ§ </view>
        <view class="mh-quick-title">æŠ‘éƒç­›æŸ¥</view>
        <view class="mh-quick-info">PHQ-9é‡è¡¨ â€¢ 9é¢˜ â€¢ ä¸“ä¸š</view>
        <view class="mh-quick-btn">å¼€å§‹æµ‹è¯•</view>
      </view>
      <view class="mh-quick-card" bindtap="startQuickTest" data-type="anxiety">
        <view class="mh-quick-icon">ğŸ˜°</view>
        <view class="mh-quick-title">ç„¦è™‘è¯„ä¼°</view>
        <view class="mh-quick-info">GAD-7é‡è¡¨ â€¢ 7é¢˜ â€¢ ä¸“ä¸š</view>
        <view class="mh-quick-btn">å¼€å§‹æµ‹è¯•</view>
      </view>
      <view class="mh-quick-card" bindtap="startQuickTest" data-type="stress">
        <view class="mh-quick-icon">ğŸ§˜</view>
        <view class="mh-quick-title">å‹åŠ›æµ‹è¯„</view>
        <view class="mh-quick-info">å‹åŠ›æ„ŸçŸ¥é‡è¡¨ â€¢ 10é¢˜ â€¢ ä¸­ç­‰</view>
        <view class="mh-quick-btn">å¼€å§‹æµ‹è¯•</view>
      </view>
    </view>
  </view>

  <!-- æµ‹è¯•åˆ†ç±» -->
  <view class="mh-section">
    <view class="mh-section-header">
      <text class="mh-section-title">ä¸“ä¸šæµ‹è¯„</text>
      <text class="mh-section-subtitle">å…¨é¢æ·±å…¥çš„å¿ƒç†å¥åº·è¯„ä¼°</text>
    </view>
    
    <!-- åˆ†ç±»æ ‡ç­¾ -->
    <view class="mh-category-tabs">
      <view wx:for="{{categories}}" wx:key="id" 
            class="mh-tab-item {{currentCategory === item.id ? 'mh-tab-active' : ''}}"
            bindtap="switchCategory" data-category="{{item.id}}">
        {{item.name}}
      </view>
    </view>

    <!-- æµ‹è¯•åˆ—è¡¨ -->
    <view class="mh-test-grid">
      <view wx:for="{{currentCategory === 'all' ? testList : testList}}" 
            wx:for-item="item"
            wx:key="id" 
            wx:if="{{currentCategory === 'all' || item.categoryId === currentCategory}}"
            class="mh-test-card mh-card-{{item.color}} {{item.hasResult ? 'mh-card-completed' : ''}}"
            bindtap="startTest" data-test="{{item}}">
        <view class="mh-test-header">
          <view class="mh-test-icon mh-bg-{{item.color}}">
            <text class="mh-icon">{{item.icon}}</text>
          </view>
          <view class="mh-test-badges">
            <view class="mh-test-badge mh-badge-{{item.color}}">{{item.difficulty}}</view>
            <!-- å®ŒæˆçŠ¶æ€æ ‡è¯† -->
            <view wx:if="{{item.hasResult}}" class="mh-completed-badge">
              <text class="mh-icon">âœ“</text>
            </view>
          </view>
        </view>
        
        <text class="mh-test-title">{{item.name}}</text>
        <text class="mh-test-desc">{{item.description}}</text>
        
        <!-- å¦‚æœæœ‰ç»“æœï¼Œæ˜¾ç¤ºæœ€æ–°ç»“æœä¿¡æ¯ -->
        <view wx:if="{{item.hasResult && item.latestResult}}" class="mh-latest-result">
          <view class="mh-result-score">
            <text class="mh-score-value mh-text-{{item.color}}">{{item.latestResult.score}}</text>
            <text class="mh-score-label">{{item.latestResult.level}}</text>
          </view>
          <text class="mh-result-date">{{item.latestResult.date}}</text>
        </view>
        
        <view class="mh-test-tags">
          <view wx:for="{{item.tags}}" wx:for-item="tag" wx:key="*this"
                class="mh-tag mh-tag-{{item.color}}">{{tag}}</view>
        </view>
        
        <view class="mh-test-meta">
          <text>{{item.duration}}åˆ†é’Ÿ</text>
          <text>{{item.questionsCount}}é¢˜</text>
        </view>
        
        <view class="mh-test-stats">
          <view class="mh-progress-wrapper">
            <text class="mh-progress-label">{{item.hasResult ? 'å·²å®Œæˆ' : 'å®Œæˆåº¦'}}</text>
            <view class="mh-progress-bar">
              <view class="mh-progress-fill mh-progress-{{item.color}}" 
                    style="width: {{item.completion}}%"></view>
            </view>
            <text class="mh-progress-text">{{item.completion}}%</text>
          </view>
        </view>
        
        <!-- æ“ä½œæŒ‰é’® -->
        <view class="mh-test-action">
          <text class="mh-action-text">{{item.hasResult ? 'æŸ¥çœ‹/é‡æµ‹' : 'å¼€å§‹æµ‹è¯•'}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æµ‹è¯•å†å² -->
  <view class="mh-section" wx:if="{{testHistory.length > 0}}">
    <view class="mh-section-header">
      <text class="mh-section-title">æµ‹è¯•å†å²</text>
      <text class="mh-section-subtitle">æŸ¥çœ‹æ‚¨çš„å†å²æµ‹è¯•è®°å½•</text>
    </view>
    
    <view class="mh-history-list">
      <view wx:for="{{testHistory}}" wx:key="id" 
            class="mh-history-card"
            bindtap="viewTestResult" data-result="{{item}}">
        <view class="mh-history-header">
          <view class="mh-history-icon mh-bg-{{item.color}}">
            <text class="mh-icon">{{item.icon}}</text>
          </view>
          <view class="mh-history-info">
            <text class="mh-history-title">{{item.testName}}</text>
            <text class="mh-history-date">{{item.date}}</text>
          </view>
          <view class="mh-history-score">
            <text class="mh-score-value mh-text-{{item.color}}">{{item.score}}</text>
            <text class="mh-score-label">{{item.level}}</text>
          </view>
        </view>
        <text class="mh-history-summary">{{item.summary}}</text>
      </view>
    </view>
  </view>

  

  <view class="mh-bottom-spacer"></view>
</view>

<!-- æµ‹è¯•æ¨¡æ€æ¡† -->
<view class="mh-test-modal {{showTestModal ? 'mh-modal-show' : ''}}" wx:if="{{currentTest}}">
  <view class="mh-test-content">
    <!-- æµ‹è¯•å¤´éƒ¨ -->
    <view class="mh-test-modal-header">
      <text class="mh-modal-title">{{currentTest.name}}</text>
      <view class="mh-progress-info">
        <text>{{currentQuestionIndex + 1}}/{{currentTest.questions.length}}</text>
      </view>
      <view class="mh-close-btn" bindtap="closeTest">Ã—</view>
    </view>
    
    <!-- è¿›åº¦æ¡ -->
    <view class="mh-progress-container">
      <view class="mh-progress-bar-full">
        <view class="mh-progress-fill-full" 
              style="width: {{(currentQuestionIndex + 1) / currentTest.questions.length * 100}}%"></view>
      </view>
    </view>

    <!-- é—®é¢˜å†…å®¹ -->
    <view class="mh-question-container" wx:if="{{currentQuestion}}">
      <view class="mh-question-header">
        <view class="mh-question-category mh-badge-{{currentTest.color}}">
          {{currentTest.category}}
        </view>
        <text class="mh-question-number">ç¬¬ {{currentQuestionIndex + 1}} é¢˜</text>
      </view>
      
      <text class="mh-question-text">{{currentQuestion.question}}</text>

      <!-- æå…‹ç‰¹é¢‘ç‡é‡è¡¨ -->
      <view wx:if="{{currentQuestion.type === 'likert_frequency' || currentQuestion.type === 'likert_frequency_reverse'}}" class="mh-likert-container">
        <view class="mh-likert-options">
          <view wx:for="{{likertFrequencyOptions}}" wx:key="value"
                class="mh-likert-option {{selectedAnswer === item.value ? 'mh-likert-selected' : ''}}"
                bindtap="selectOption" data-value="{{item.value}}">
            <text class="mh-likert-icon">{{item.icon}}</text>
            <text class="mh-likert-label">{{item.label}}</text>
          </view>
        </view>
      </view>

      <!-- æå…‹ç‰¹åŒæ„é‡è¡¨ -->
      <view wx:if="{{currentQuestion.type === 'likert_agreement'}}" class="mh-likert-container">
        <view class="mh-likert-options">
          <view wx:for="{{likertAgreementOptions}}" wx:key="value"
                class="mh-likert-option {{selectedAnswer === item.value ? 'mh-likert-selected' : ''}}"
                bindtap="selectOption" data-value="{{item.value}}">
            <text class="mh-likert-icon">{{item.icon}}</text>
            <text class="mh-likert-label">{{item.label}}</text>
          </view>
        </view>
      </view>

      <!-- é€‰æ‹©é¢˜ -->
      <view wx:if="{{currentQuestion.type === 'choice'}}" class="mh-options-container">
        <view wx:for="{{currentQuestion.options}}" wx:key="value"
              class="mh-option-item {{selectedAnswer === item.value ? 'mh-option-selected' : ''}}"
              bindtap="selectOption" data-value="{{item.value}}">
          <view class="mh-option-radio">
            <view wx:if="{{selectedAnswer === item.value}}" class="mh-radio-dot"></view>
          </view>
          <text class="mh-option-text">{{item.text}}</text>
        </view>
      </view>

      <!-- æ»‘å— -->
      <view wx:if="{{currentQuestion.type === 'slider'}}" class="mh-slider-container">
        <view class="mh-slider-labels">
          <text>{{currentQuestion.minLabel}}</text>
          <text>{{currentQuestion.maxLabel}}</text>
        </view>
        <slider class="mh-slider" 
                min="{{currentQuestion.min}}" 
                max="{{currentQuestion.max}}" 
                value="{{selectedAnswer || currentQuestion.min}}"
                bindchange="onSliderChange" />
        <view class="mh-slider-value">{{selectedAnswer || currentQuestion.min}}</view>
      </view>
    </view>

    <!-- å¯¼èˆªæŒ‰é’® -->
    <view class="mh-test-navigation">
      <view class="mh-nav-btn {{currentQuestionIndex === 0 ? 'mh-btn-disabled' : 'mh-btn-secondary'}}"
            bindtap="previousQuestion">
        ä¸Šä¸€é¢˜
      </view>
      
      <view class="mh-auto-save-tip">
        <text class="mh-icon">ğŸ’¾</text>
        <text>è‡ªåŠ¨ä¿å­˜</text>
      </view>
      
      <view class="mh-nav-btn {{selectedAnswer === null ? 'mh-btn-disabled' : 'mh-btn-primary'}}"
            bindtap="nextQuestion">
        {{currentQuestionIndex === currentTest.questions.length - 1 ? 'å®Œæˆæµ‹è¯•' : 'ä¸‹ä¸€é¢˜'}}
      </view>
    </view>
  </view>
</view> 