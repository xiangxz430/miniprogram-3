<!-- MBTIäººæ ¼æµ‹è¯•é¡µé¢ -->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header">
    <text class="title">MBTIäººæ ¼ç³»ç»Ÿ</text>
    <text class="subtitle">æ¢ç´¢ä½ çš„äººæ ¼ç‰¹è´¨ä¸æ½œèƒ½</text>
  </view>
  
  <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
  <view class="tab-nav">
    <view class="tab-wrapper">
      <view 
        wx:for="{{tabItems}}" 
        wx:key="index"
        class="tab-item {{activeTab == index ? 'active' : ''}}" 
        bindtap="switchTab" 
        data-index="{{index}}"
      >
        <view class="tab-text">{{item.text}}</view>
      </view>
      <view class="slider" style="left: {{activeTab * (100/tabItems.length)}}%; width: {{100/tabItems.length}}%"></view>
    </view>
  </view>
  
  <!-- æµ‹è¯•å†…å®¹æ ‡ç­¾é¡µ -->
  <view class="tab-content" hidden="{{activeTab != 0}}">
    <!-- æµ‹è¯•æ¨¡å¼é€‰æ‹©ç•Œé¢ -->
    <block wx:if="{{showTestModeSelection}}">
      <view class="mode-selection">
        <view class="mode-title">é€‰æ‹©æµ‹è¯•ç‰ˆæœ¬</view>
        <view class="mode-description">è¯·é€‰æ‹©é€‚åˆæ‚¨çš„æµ‹è¯•ç‰ˆæœ¬</view>
        
        <view class="mode-options">
          <view class="mode-option" bindtap="selectTestMode" data-mode="standard">
            <view class="mode-icon">ğŸ“</view>
            <view class="mode-name">æ ‡å‡†ç‰ˆ</view>
            <view class="mode-detail">141é¢˜å®Œæ•´æµ‹è¯•ï¼Œçº¦éœ€15-20åˆ†é’Ÿ</view>
          </view>
          
          <view class="mode-option" bindtap="selectTestMode" data-mode="short">
            <view class="mode-icon">âš¡ï¸</view>
            <view class="mode-name">ç®€åŒ–ç‰ˆ</view>
            <view class="mode-detail">31é¢˜ç²¾ç®€æµ‹è¯•ï¼Œçº¦éœ€5-8åˆ†é’Ÿ</view>
          </view>
        </view>
      </view>
    </block>
    
    <!-- æµ‹è¯•æœªå®Œæˆæ—¶æ˜¾ç¤ºé¢˜ç›® -->
    <block wx:elif="{{!testCompleted}}">
      <view class="progress-container">
        <view class="progress-text">é—®é¢˜ {{currentQuestion + 1}}/{{questions.length}}</view>
        <view class="progress-bar">
          <view class="progress-value" style="width: {{(currentQuestion + 1) / questions.length * 100}}%;"></view>
        </view>
      </view>
      
      <view class="question-card">
        <view class="question-number">ç¬¬{{currentQuestion + 1}}é¢˜</view>
        <view class="question-text">{{questions[currentQuestion].text || questions[currentQuestion].question}}</view>
        <view class="options-container">
          <view class="option {{selectedOption === 'A' ? 'active' : ''}}" bindtap="selectOption" data-value="A">
            <view class="radio {{selectedOption === 'A' ? 'checked' : ''}}"></view>
            <text>{{questions[currentQuestion].options.A || questions[currentQuestion].optionA}}</text>
          </view>
          <view class="option {{selectedOption === 'B' ? 'active' : ''}}" bindtap="selectOption" data-value="B">
            <view class="radio {{selectedOption === 'B' ? 'checked' : ''}}"></view>
            <text>{{questions[currentQuestion].options.B || questions[currentQuestion].optionB}}</text>
          </view>
        </view>
      </view>
      
      <!-- å¯¼èˆªæŒ‰é’® -->
      <view class="navigation-buttons">
        <view class="question-nav">
          <button class="prev-btn" bindtap="prevQuestion" disabled="{{currentQuestion === 0}}">ä¸Šä¸€é¢˜</button>
          <button class="next-btn" bindtap="nextQuestion" disabled="{{!selectedOption}}">{{currentQuestion === questions.length - 1 ? 'å®Œæˆæµ‹è¯•' : 'ä¸‹ä¸€é¢˜'}}</button>
        </view>
        <button class="back-to-mode-btn" bindtap="backToTestMode">è¿”å›é€‰æ‹©æµ‹è¯•ç‰ˆæœ¬</button>
      </view>
      
      <view class="test-tips">
        <text class="tip-text">è¯·æ ¹æ®æ‚¨çš„ç¬¬ä¸€ååº”é€‰æ‹©æœ€ç¬¦åˆçš„é€‰é¡¹</text>
        <text class="tip-text">ç­”æ¡ˆæ²¡æœ‰å¯¹é”™ä¹‹åˆ†ï¼Œé€‰æ‹©æœ€é€‚åˆæ‚¨çš„é€‰é¡¹å³å¯</text>
      </view>
    </block>
    
    <!-- æµ‹è¯•å®Œæˆåæ˜¾ç¤ºç»“æœ -->
    <block wx:else>
      <view class="result-section">
        <view class="result-header">
          <view class="result-title">ä½ çš„MBTIç±»å‹</view>
          <text class="result-time">{{result.timeStr || 'åˆšåˆš'}}</text>
        </view>
        
        <view class="personality-card">
          <view class="flex justify-between items-center">
            <view class="personality-type">{{result.type}}</view>
            <view class="personality-percentage">å æ¯” {{result.percentage}}</view>
          </view>
          <view class="personality-name">{{result.name}}</view>
          <view class="personality-alias">{{result.alias || 'æ€æƒ³å®¶'}}</view>
        </view>
        
        <view class="personality-description-box">
          <view class="personality-description">{{result.description}}</view>
        </view>
        
        <!-- å®Œæ•´æè¿° -->
        <view class="section-title">å®Œæ•´æ€§æ ¼æè¿°</view>
        <view class="full-description-box">
          <view class="full-description">{{result.fullDescription || result.description}}</view>
        </view>
        
        <!-- æ€§æ ¼ä¼˜åŠ¿å’ŒåŠ£åŠ¿ -->
        <view class="strengths-weaknesses">
          <view class="sw-container">
            <view class="section-title">æ€§æ ¼ä¼˜åŠ¿</view>
            <view class="sw-list">
              <view class="sw-item" wx:for="{{result.strengths}}" wx:key="index">
                <view class="sw-bullet">âœ“</view>
                <view class="sw-text">{{item}}</view>
              </view>
            </view>
          </view>
          
          <view class="sw-container">
            <view class="section-title">æ€§æ ¼åŠ£åŠ¿</view>
            <view class="sw-list">
              <view class="sw-item" wx:for="{{result.weaknesses}}" wx:key="index">
                <view class="sw-bullet">!</view>
                <view class="sw-text">{{item}}</view>
              </view>
            </view>
          </view>
        </view>
        
        <view class="section-title">æ€§æ ¼åå¥½åˆ†æ</view>
        <view class="preference-container">
          <block wx:if="{{result.scores}}">
            <view class="preference-item">
              <view class="preference-header">
                <view class="preference-name">å†…å‘ (I)</view>
                <view class="preference-vs">vs</view>
                <view class="preference-name">å¤–å‘ (E)</view>
              </view>
              <view class="preference-bar">
                <view class="preference-value" style="width: {{result.scores.I || 0}}%;"></view>
              </view>
              <view class="preference-percentage">{{result.scores.I || 0}}%</view>
            </view>
            
            <view class="preference-item">
              <view class="preference-header">
                <view class="preference-name">ç›´è§‰ (N)</view>
                <view class="preference-vs">vs</view>
                <view class="preference-name">å®æ„Ÿ (S)</view>
              </view>
              <view class="preference-bar">
                <view class="preference-value" style="width: {{result.scores.N || 0}}%;"></view>
              </view>
              <view class="preference-percentage">{{result.scores.N || 0}}%</view>
            </view>
            
            <view class="preference-item">
              <view class="preference-header">
                <view class="preference-name">æƒ…æ„Ÿ (F)</view>
                <view class="preference-vs">vs</view>
                <view class="preference-name">æ€è€ƒ (T)</view>
              </view>
              <view class="preference-bar">
                <view class="preference-value" style="width: {{result.scores.F || 0}}%;"></view>
              </view>
              <view class="preference-percentage">{{result.scores.F || 0}}%</view>
            </view>
            
            <view class="preference-item">
              <view class="preference-header">
                <view class="preference-name">åˆ¤æ–­ (J)</view>
                <view class="preference-vs">vs</view>
                <view class="preference-name">æ„ŸçŸ¥ (P)</view>
              </view>
              <view class="preference-bar">
                <view class="preference-value" style="width: {{result.scores.P || 0}}%;"></view>
              </view>
              <view class="preference-percentage">{{result.scores.P || 0}}%</view>
            </view>
          </block>
          <block wx:else>
            <view class="no-data-message">æš‚æ— åå¥½åˆ†ææ•°æ®</view>
          </block>
        </view>
        
        <view class="section-title">è®¤çŸ¥åŠŸèƒ½æ ˆ</view>
        <view class="cognitive-functions">
          <block wx:if="{{result.functions && result.functions.length >= 4}}">
            <view class="function-item primary">
              <view class="function-header">
                <text class="function-name">{{result.functions[0].code}} - {{result.functions[0].name}}</text>
                <text class="function-role">ä¸»å¯¼åŠŸèƒ½</text>
              </view>
              <text class="function-description">{{result.functions[0].description}}</text>
            </view>
            
            <view class="function-item secondary">
              <view class="function-header">
                <text class="function-name">{{result.functions[1].code}} - {{result.functions[1].name}}</text>
                <text class="function-role">è¾…åŠ©åŠŸèƒ½</text>
              </view>
              <text class="function-description">{{result.functions[1].description}}</text>
            </view>
            
            <view class="function-item tertiary">
              <view class="function-header">
                <text class="function-name">{{result.functions[2].code}} - {{result.functions[2].name}}</text>
                <text class="function-role">ç¬¬ä¸‰åŠŸèƒ½</text>
              </view>
              <text class="function-description">{{result.functions[2].description}}</text>
            </view>
            
            <view class="function-item inferior">
              <view class="function-header">
                <text class="function-name">{{result.functions[3].code}} - {{result.functions[3].name}}</text>
                <text class="function-role">åŠ£åŠ¿åŠŸèƒ½</text>
              </view>
              <text class="function-description">{{result.functions[3].description}}</text>
            </view>
          </block>
          <block wx:else>
            <view class="no-data-message">æš‚æ— è®¤çŸ¥åŠŸèƒ½æ•°æ®</view>
          </block>
        </view>
        
        <!-- èŒä¸šå»ºè®® -->
        <view class="section-title">é€‚åˆçš„èŒä¸š</view>
        <view class="careers-container">
          <view class="careers-list">
            <view class="career-item" wx:for="{{result.careers}}" wx:key="index">
              <view class="career-icon">ğŸ’¼</view>
              <view class="career-name">{{item}}</view>
            </view>
          </view>
        </view>
        
        <!-- äººé™…å…³ç³»ç‰¹ç‚¹ -->
        <view class="section-title">äººé™…å…³ç³»</view>
        <view class="relationship-box">
          <view class="relationship-section">
            <view class="relationship-title">ä¼˜åŠ¿</view>
            <view class="relationship-content">{{result.relationshipStrengths}}</view>
          </view>
          <view class="relationship-section">
            <view class="relationship-title">æŒ‘æˆ˜</view>
            <view class="relationship-content">{{result.relationshipChallenges}}</view>
          </view>
        </view>
        
        <!-- æ²Ÿé€šä¸å·¥ä½œé£æ ¼ -->
        <view class="section-title">æ²Ÿé€šä¸å·¥ä½œ</view>
        <view class="style-container">
          <view class="style-item">
            <view class="style-title">æ²Ÿé€šé£æ ¼</view>
            <view class="style-content">{{result.communicationStyle}}</view>
          </view>
          <view class="style-item">
            <view class="style-title">å·¥ä½œé£æ ¼</view>
            <view class="style-content">{{result.workStyle}}</view>
          </view>
        </view>
        
        <!-- æˆé•¿ä¸å‘å±• -->
        <view class="section-title">æˆé•¿ä¸å‘å±•</view>
        <view class="growth-container">
          <view class="growth-item">
            <view class="growth-title">å‹åŠ›ä¸‹ååº”</view>
            <view class="growth-content">{{result.stressReactions}}</view>
          </view>
          <view class="growth-item">
            <view class="growth-title">æˆé•¿æ–¹å‘</view>
            <view class="growth-content">{{result.growthAreas}}</view>
          </view>
        </view>
        
        <!-- è‘—åäººç‰© -->
        <view class="section-title">ç›¸åŒç±»å‹çš„åäºº</view>
        <view class="famous-people">
          <view class="people-item" wx:for="{{result.famousPeople}}" wx:key="index">
            <view class="people-icon">ğŸ‘¤</view>
            <view class="people-name">{{item}}</view>
          </view>
        </view>
        
        <button class="restart-btn" bindtap="restartTest">é‡æ–°æµ‹è¯•</button>
      </view>
    </block>
  </view>
  
  <!-- äººæ ¼æ¨¡å‹æ ‡ç­¾é¡µ -->
  <view class="tab-content" hidden="{{activeTab != 1}}">
    <block wx:if="{{result && result.type}}">
      <view class="model-section">
        <view class="section-title">äººæ ¼æ¨¡å‹</view>
        <!-- äººæ ¼æ¨¡å‹
        <view class="model-card">
          <view class="model-header">
            <view class="model-icon">â˜¯</view>
            <view class="model-title">
              <text class="model-name">ä¸ªäººæ•°æ®ä¸MBTIè½¬åŒ–</text>
              <text class="model-subtitle">å°†ä¸ªäººæ•°æ®å¯¹åº”MBTIåŠŸèƒ½è½´</text>
            </view>
          </view>
          
          <view class="model-content">
            <view class="connection-item">
              <text class="connection-left">æ­£å®˜</text>
              <view class="connection-line"></view>
              <text class="connection-right">Te</text>
            </view>
            <view class="connection-item">
              <text class="connection-left">ä¼¤å®˜</text>
              <view class="connection-line"></view>
              <text class="connection-right">Ne</text>
            </view>
            <view class="connection-item">
              <text class="connection-left">é£Ÿç¥</text>
              <view class="connection-line"></view>
              <text class="connection-right">Fe</text>
            </view>
            <view class="connection-item">
              <text class="connection-left">åå°</text>
              <view class="connection-line"></view>
              <text class="connection-right">Ni</text>
            </view>
          </view>
        </view>
         -->
        <view class="personality-grid">
          <view class="personality-grid-item">
            <view class="grid-title">åŸç”Ÿäººæ ¼</view>
            <view class="grid-type">{{modelData.nativeType}}</view>
            <view class="grid-name">{{modelData.nativeName}}</view>
            <view class="grid-description">{{modelData.nativeDescription}}</view>
          </view>
          
          <view class="personality-grid-item">
            <view class="grid-title">ç¤¾ä¼šé¢å…·</view>
            <view class="grid-type">{{modelData.socialType}}</view>
            <view class="grid-name">{{modelData.socialName}}</view>
            <view class="grid-description">{{modelData.socialDescription}}</view>
          </view>
        </view>
        
        <view class="radar-section">
          <view class="section-title">äººæ ¼èƒ½é‡é›·è¾¾</view>
          <view class="radar-chart">
            <view class="radar-axis">
              <view class="radar-axis-line"></view>
              <view class="radar-axis-line"></view>
              <view class="radar-axis-line"></view>
              <view class="radar-axis-line"></view>
            </view>
            <view class="radar-value" style="--thinking: {{modelData.radarData.thinking}}; --creativity: {{modelData.radarData.creativity}}; --execution: {{modelData.radarData.execution}}; --perception: {{modelData.radarData.perception}};"></view>
            <view class="radar-point radar-point-thinking"></view>
            <view class="radar-point radar-point-creativity"></view>
            <view class="radar-point radar-point-execution"></view>
            <view class="radar-point radar-point-perception"></view>
          </view>
          <view class="radar-labels">
            <text class="radar-label">æ€è€ƒåŠ›
              <text class="radar-value-label">{{modelData.radarData.thinking}}%</text>
            </text>
            <text class="radar-label">åˆ›é€ åŠ›
              <text class="radar-value-label">{{modelData.radarData.creativity}}%</text>
            </text>
            <text class="radar-label">æ‰§è¡ŒåŠ›
              <text class="radar-value-label">{{modelData.radarData.execution}}%</text>
            </text>
            <text class="radar-label">æ„ŸçŸ¥åŠ›
              <text class="radar-value-label">{{modelData.radarData.perception}}%</text>
            </text>
          </view>
        </view>
        
        <!-- å…³ç³»åŒ¹é…éƒ¨åˆ† -->
        <view class="relationship-match-section">
          <view class="section-title">å…³ç³»åŒ¹é…</view>
          
          <view class="relationship-header">
            <view class="icon icon-heart">ğŸ’–</view>
            <view class="relationship-title">é€‚åˆçš„äººæ ¼åŒ¹é…</view>
          </view>
          
          <view class="relationship-description">åŸºäºMBTIç‰¹è´¨å’Œäººæ ¼äº’è¡¥åŸåˆ™ï¼Œä»¥ä¸‹äººæ ¼ç±»å‹ä¸ä½ æœ€ä¸ºåŒ¹é…ï¼š</view>
          
          <view class="relationship-categories">
            <view class="relationship-category">
              <view class="category-header">
                <view class="category-icon">ğŸ¤</view>
                <view class="category-title">ç†æƒ³æœ‹å‹</view>
              </view>
              
              <view class="relationship-items">
                <view class="relationship-item" wx:for="{{modelData.relationships.friends}}" wx:key="type">
                  <view class="relationship-type">
                    <text class="type-code">{{item.type}}</text>
                    <text class="type-name">{{item.typeName || ''}}</text>
                  </view>
                  <view class="relationship-score">
                    <view class="score-bar">
                      <view class="score-value" style="width: {{item.score}}%;"></view>
                    </view>
                    <view class="score-text">{{item.score}}%</view>
                  </view>
                  <view class="relationship-reason">{{item.reason}}</view>
                </view>
              </view>
            </view>
            
            <view class="relationship-category">
              <view class="category-header">
                <view class="category-icon">â¤ï¸</view>
                <view class="category-title">ç†æƒ³ä¼´ä¾£</view>
              </view>
              
              <view class="relationship-items">
                <view class="relationship-item" wx:for="{{modelData.relationships.partners}}" wx:key="type">
                  <view class="relationship-type">
                    <text class="type-code">{{item.type}}</text>
                    <text class="type-name">{{item.typeName || ''}}</text>
                  </view>
                  <view class="relationship-score">
                    <view class="score-bar">
                      <view class="score-value" style="width: {{item.score}}%;"></view>
                    </view>
                    <view class="score-text">{{item.score}}%</view>
                  </view>
                  <view class="relationship-reason">{{item.reason}}</view>
                </view>
              </view>
            </view>
          </view>
          
          <view class="relationship-tip">
            <view class="tip-icon">â„¹ï¸</view>
            <text class="tip-text">äººæ ¼ç±»å‹ä»…ä½œä¸ºå‚è€ƒï¼ŒçœŸå®å…³ç³»ä¸­è¿˜å—åˆ°ä¸ªäººæˆé•¿ã€ä»·å€¼è§‚å’Œç”Ÿæ´»ç»å†ç­‰å¤šç§å› ç´ å½±å“ã€‚</text>
          </view>
        </view>
      </view>
      
      <view class="career-section">
        <view class="section-title">èŒä¸šç½—ç›˜</view>
        
        <view class="career-traits">
          <view class="career-traits-header">
            <view class="icon icon-purple">ğŸ§ </view>
            <view class="career-traits-title">èŒä¸šç‰¹è´¨åˆ†æ</view>
          </view>
          
          <view class="traits-grid">
            <view class="trait-item">
              <view class="trait-title">å·¥ä½œé£æ ¼</view>
              <view class="trait-content">{{modelData.careerTraits.workStyle}}</view>
            </view>
            
            <view class="trait-item">
              <view class="trait-title">å›¢é˜Ÿè§’è‰²</view>
              <view class="trait-content">{{modelData.careerTraits.teamRole}}</view>
            </view>
          </view>
          
          <view class="trait-strength-weakness">
            <view class="trait-sw-item advantage">
              <view class="trait-sw-header">
                <view class="trait-sw-icon">ğŸ’ª</view>
                <view class="trait-sw-title">èŒåœºä¼˜åŠ¿</view>
              </view>
              <view class="trait-sw-content">{{modelData.careerTraits.advantage}}</view>
            </view>
            
            <view class="trait-sw-item challenge">
              <view class="trait-sw-header">
                <view class="trait-sw-icon">âš ï¸</view>
                <view class="trait-sw-title">æ½œåœ¨æŒ‘æˆ˜</view>
              </view>
              <view class="trait-sw-content">{{modelData.careerTraits.challenge}}</view>
            </view>
          </view>
          
          <view class="trait-development">
            <view class="trait-dev-header">
              <view class="trait-dev-icon">ğŸŒ±</view>
              <view class="trait-dev-title">æˆé•¿å»ºè®®</view>
            </view>
            <view class="trait-dev-content">{{modelData.careerTraits.development}}</view>
          </view>
        </view>
        
        <view class="industry-match">
          <view class="industry-header">
            <view class="icon icon-blue">ğŸ’¼</view>
            <view class="industry-title">è¡Œä¸šåŒ¹é…</view>
          </view>
          
          <view class="industry-description">æ ¹æ®ä½ çš„äº”è¡Œå–œç”¨ç¥å’ŒMBTIç‰¹è´¨ï¼Œä»¥ä¸‹è¡Œä¸šæœ€é€‚åˆä½ ï¼š</view>
          
          <view class="industry-grid">
            <view class="industry-item" wx:for="{{modelData.industries}}" wx:key="index">
              <view class="icon {{item.icon}} icon-blue"></view>
              <text class="industry-item-name">{{item.name}}</text>
            </view>
          </view>
        </view>
        
        <view class="direction-match">
          <view class="direction-header">
            <view class="icon icon-blue">ğŸ§­</view>
            <view class="direction-title">å·¥ä½œæ–¹ä½</view>
          </view>
          
          <view class="direction-grid">
            <view class="direction-item {{item.type}}" wx:for="{{modelData.directions}}" wx:key="index">
              <text class="direction-item-name">{{item.name}} ({{item.type === 'good' ? 'å‰' : 'å¿Œ'}})</text>
            </view>
          </view>
          
          <view class="direction-tip">
            <view class="tip-icon">â„¹ï¸</view>
            <text class="tip-text">{{modelData.directionTip}}</text>
          </view>
        </view>
      </view>
    </block>
    <block wx:else>
      <view class="no-result-prompt">
        <view class="prompt-icon">ğŸ§­</view>
        <view class="prompt-title">è¯·å…ˆå®ŒæˆMBTIæµ‹è¯•</view>
        <view class="prompt-description">å®Œæˆæµ‹è¯•åï¼Œå°†æ ¹æ®æ‚¨çš„äººæ ¼ç±»å‹ä¸ºæ‚¨æä¾›é‡èº«å®šåˆ¶çš„äººæ ¼æ¨¡å‹å’ŒèŒä¸šå»ºè®®</view>
        <button class="switch-to-test-btn" bindtap="switchToTestTab">å»æµ‹è¯•</button>
      </view>
    </block>
  </view>

  <!-- AIå»ºè®®æ ‡ç­¾é¡µ -->
  <view class="tab-content" hidden="{{activeTab != 2}}">
    <block wx:if="{{!testCompleted}}">
      <view class="ai-advice-placeholder">
        <view class="placeholder-icon">ğŸ¤–</view>
        <view class="placeholder-text">è¯·å…ˆå®ŒæˆMBTIæµ‹è¯•ï¼Œæ‰èƒ½è·å–ä¸ªæ€§åŒ–AIå»ºè®®</view>
        <button class="primary-btn" bindtap="switchToTestTab">å¼€å§‹æµ‹è¯•</button>
      </view>
    </block>
    <block wx:elif="{{!aiAdviceLoaded}}">
      <view class="ai-loading">
        <view class="loading-icon">â³</view>
        <view class="loading-text">æ­£åœ¨ç”Ÿæˆæ‚¨çš„ä¸ªæ€§åŒ–AIå»ºè®®...</view>
        <view class="loading-spinner"></view>
      </view>
      
      <!-- éª¨æ¶å±å ä½å†…å®¹ -->
      <view class="ai-advice-skeleton">
        <view class="ai-advice-header skeleton-header">
          <view class="ai-avatar skeleton-avatar"></view>
          <view class="ai-header-text">
            <view class="ai-title skeleton-text-long"></view>
            <view class="ai-subtitle skeleton-text-short"></view>
          </view>
        </view>
        
        <!-- ä¸ªæ€§åŒ–å‘å±•å»ºè®®å ä½ -->
        <view class="advice-section skeleton-section">
          <view class="section-title skeleton-title"></view>
          <view class="advice-content">
            <view class="skeleton-text-line"></view>
            <view class="skeleton-text-line"></view>
            <view class="skeleton-text-line"></view>
            <view class="skeleton-text-line"></view>
          </view>
        </view>
        
        <!-- èŒä¸šå‘å±•æŒ‡å¯¼å ä½ -->
        <view class="advice-section skeleton-section">
          <view class="section-title skeleton-title"></view>
          <view class="advice-content">
            <view class="skeleton-text-line"></view>
            <view class="skeleton-text-line"></view>
            <view class="skeleton-text-line"></view>
          </view>
        </view>
        
        <!-- äººé™…å…³ç³»ä¸æ²Ÿé€šå ä½ -->
        <view class="advice-section skeleton-section">
          <view class="section-title skeleton-title"></view>
          <view class="advice-content">
            <view class="skeleton-text-line"></view>
            <view class="skeleton-text-line"></view>
            <view class="skeleton-text-line"></view>
          </view>
        </view>
        
        <!-- å‹åŠ›ç®¡ç†ç­–ç•¥å ä½ -->
        <view class="advice-section skeleton-section">
          <view class="section-title skeleton-title"></view>
          <view class="advice-content">
            <view class="skeleton-text-line"></view>
            <view class="skeleton-text-line"></view>
          </view>
        </view>
        
        <!-- åˆ—è¡¨å ä½ -->
        <view class="advice-lists-container">
          <view class="advice-list skeleton-list">
            <view class="list-title skeleton-title"></view>
            <view class="list-items">
              <view class="list-item skeleton-list-item">
                <view class="item-bullet skeleton-bullet"></view>
                <view class="item-text skeleton-text-short"></view>
              </view>
              <view class="list-item skeleton-list-item">
                <view class="item-bullet skeleton-bullet"></view>
                <view class="item-text skeleton-text-short"></view>
              </view>
              <view class="list-item skeleton-list-item">
                <view class="item-bullet skeleton-bullet"></view>
                <view class="item-text skeleton-text-short"></view>
              </view>
            </view>
          </view>
          
          <view class="advice-list skeleton-list">
            <view class="list-title skeleton-title"></view>
            <view class="list-items">
              <view class="list-item skeleton-list-item">
                <view class="item-bullet skeleton-bullet"></view>
                <view class="item-text skeleton-text-short"></view>
              </view>
              <view class="list-item skeleton-list-item">
                <view class="item-bullet skeleton-bullet"></view>
                <view class="item-text skeleton-text-short"></view>
              </view>
              <view class="list-item skeleton-list-item">
                <view class="item-bullet skeleton-bullet"></view>
                <view class="item-text skeleton-text-short"></view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </block>
    <block wx:elif="{{aiAdviceError}}">
      <view class="ai-error">
        <view class="error-icon">âŒ</view>
        <view class="error-text">{{aiAdviceErrorMsg || 'è·å–AIå»ºè®®å¤±è´¥ï¼Œè¯·ç¨åå†è¯•'}}</view>
        <button class="retry-btn" bindtap="loadAiAdvice">é‡è¯•</button>
      </view>
    </block>
    <block wx:else>
      <view class="ai-advice-container">
        <view class="ai-advice-header">
          <view class="ai-avatar">ğŸ¤–</view>
          <view class="ai-header-text">
            <view class="ai-title">AIä¸ªæ€§åŒ–å»ºè®®</view>
            <view class="ai-subtitle">åŸºäº{{result.type}} ({{result.name}})äººæ ¼ç‰¹è´¨</view>
          </view>
        </view>
        
        <view class="advice-section">
          <view class="section-title">ä¸ªæ€§åŒ–å‘å±•å»ºè®®</view>
          <view class="advice-content">{{aiAdvice.overallAdvice}}</view>
        </view>
        
        <view class="advice-section">
          <view class="section-title">èŒä¸šå‘å±•æŒ‡å¯¼</view>
          <view class="advice-content">{{aiAdvice.careerAdvice}}</view>
        </view>
        
        <view class="advice-section">
          <view class="section-title">äººé™…å…³ç³»ä¸æ²Ÿé€š</view>
          <view class="advice-content">{{aiAdvice.relationshipAdvice}}</view>
        </view>
        
        <view class="advice-section">
          <view class="section-title">å‹åŠ›ç®¡ç†ç­–ç•¥</view>
          <view class="advice-content">{{aiAdvice.stressManagement}}</view>
        </view>
        
        <view class="advice-lists-container">
          <view class="advice-list">
            <view class="list-title">ä¸ªäººæˆé•¿æ–¹å‘</view>
            <view class="list-items">
              <view class="list-item" wx:for="{{aiAdvice.growthAreas}}" wx:key="index">
                <view class="item-bullet">âœ“</view>
                <view class="item-text">{{item}}</view>
              </view>
            </view>
          </view>
          
          <view class="advice-list">
            <view class="list-title">éœ€è¦é¿å…çš„é™·é˜±</view>
            <view class="list-items">
              <view class="list-item" wx:for="{{aiAdvice.pitfalls}}" wx:key="index">
                <view class="item-bullet">âš ï¸</view>
                <view class="item-text">{{item}}</view>
              </view>
            </view>
          </view>
        </view>
        
        <view class="advice-footer">
          <view class="refresh-hint">éœ€è¦æ›´æ–°å»ºè®®ï¼Ÿ</view>
          <button class="refresh-btn" bindtap="refreshAiAdvice">åˆ·æ–°AIå»ºè®®</button>
        </view>
      </view>
    </block>
  </view>

  <!-- æ¯æ—¥åˆ†ææ ‡ç­¾é¡µ -->
  <view class="tab-content" hidden="{{activeTab != 3}}">
    <!-- å¤©æ°”å¡ç‰‡ -->
    <view class="weather-card">
      <view class="location-info">
        <text class="city-name">{{weatherData.city}}</text>
        <text class="current-time">{{currentTime}}</text>
      </view>
      
      <view class="weather-info">
        <view class="current-weather">
          <text class="temperature">{{weatherData.currentTemp}}Â°</text>
          <view class="temp-range">
            <text>æœ€é«˜ {{weatherData.maxTemp}}Â°</text>
            <text>æœ€ä½ {{weatherData.minTemp}}Â°</text>
          </view>
        </view>
        
        <view class="weather-details">
          <view class="detail-item">
            <text class="label">å¤©æ°”</text>
            <text class="value">{{weatherData.condition}}</text>
          </view>
          <view class="detail-item">
            <text class="label">æ¹¿åº¦</text>
            <text class="value">{{weatherData.humidity}}%</text>
          </view>
          <view class="detail-item">
            <text class="label">é£é€Ÿ</text>
            <text class="value">{{weatherData.windSpeed}}</text>
          </view>
          <view class="detail-item">
            <text class="label">ç©ºæ°”è´¨é‡</text>
            <text class="value">{{weatherData.airQuality}}</text>
          </view>
        </view>
      </view>
      
      <!-- 24å°æ—¶å¤©æ°”é¢„æŠ¥ -->
      <view class="hourly-forecast">
        <scroll-view scroll-x="true" class="forecast-scroll">
          <view class="forecast-item" wx:for="{{weatherData.hourlyForecast}}" wx:key="time">
            <text class="time">{{item.time}}</text>
            <text class="temp">{{item.temp}}Â°</text>
            <text class="rain-prob" wx:if="{{item.rainProb}}">{{item.rainProb}}%</text>
          </view>
        </scroll-view>
      </view>
    </view>
    
    <!-- ä»Šæ—¥é»„å† -->
    <view class="lunar-calendar" wx:if="{{lunarCalendar}}">
      <!-- é»„å†å¤´éƒ¨ -->
      <view class="calendar-header">
        <view class="header-left">
          <view class="suitable-title">å®œ</view>
          <view class="suitable-list">
            <text wx:for="{{lunarCalendar.suitable || lunarCalendar.activities.suitable}}" wx:key="index" class="activity-item">{{item}}</text>
          </view>
        </view>
        
        <view class="header-center">
          <view class="date-main">
            <view class="solar-info">
              <text class="solar-text">å…¬å† {{lunarCalendar.solarYear}}å¹´{{lunarCalendar.solarMonth}}æœˆ{{lunarCalendar.solarDay}}æ—¥ {{lunarCalendar.weekday}} {{lunarCalendar.zodiacSign}}åº§ (é˜³å†)</text>
            </view>
            <view class="date-display">
              <text class="month-year">ã€{{lunarCalendar.solarYear}}ã€‘</text>
              <text class="day-large">{{lunarCalendar.solarMonth}}æœˆ{{lunarCalendar.solarDay}}æ—¥</text>
            </view>
            <view class="weekday">{{lunarCalendar.weekday}}</view>
            <view class="lunar-info">å†œå† {{lunarCalendar.lunarDate}} (é˜´å†)</view>
          </view>
        </view>
        
        <view class="header-right">
          <view class="avoid-title">å¿Œ</view>
          <view class="avoid-list">
            <text wx:for="{{lunarCalendar.avoid || lunarCalendar.activities.avoid}}" wx:key="index" class="activity-item">{{item}}</text>
          </view>
        </view>
      </view>

      <!-- é»„å†å†…å®¹ -->
      <view class="calendar-content">
        <!-- èƒç¥å’Œäº”è¡Œä¿¡æ¯ -->
        <view class="info-row">
          <view class="info-section">
            <view class="info-label">èƒç¥ï¼š</view>
            <view class="info-value">{{lunarCalendar.taishen}}</view>
          </view>
          <view class="info-section">
            <view class="info-label">äº”è¡Œï¼š</view>
            <view class="info-value">{{lunarCalendar.nayin}} {{lunarCalendar.wuxing}}æ‰§ä½</view>
          </view>
        </view>

        <!-- å‰ç¥å®œè¶‹ -->
        <view class="gods-section">
          <view class="gods-left">
            <view class="gods-title">å‰ç¥å®œè¶‹</view>
            <view class="gods-content">
              <text wx:for="{{lunarCalendar.jishen}}" wx:key="index" class="gods-item">{{item}}</text>
            </view>
          </view>

          <!-- å¹²æ”¯ä¿¡æ¯ -->
          <view class="ganzhi-center">
            <view class="ganzhi-box">
              <text class="ganzhi-text">{{lunarCalendar.yearGanzhi}} {{lunarCalendar.monthGanzhi}} {{lunarCalendar.dayGanzhi}}</text>
              <view class="pengzu-text">{{lunarCalendar.pengzu || lunarCalendar.dailyWords}}</view>
            </view>
          </view>

          <!-- å‡¶ç¥å®œå¿Œ -->
          <view class="gods-right">
            <view class="gods-title">å‡¶ç¥å®œå¿Œ</view>
            <view class="gods-content">
              <text wx:for="{{lunarCalendar.xiongshen}}" wx:key="index" class="gods-item">{{item}}</text>
            </view>
          </view>
        </view>

        <!-- è´¢ç¥æ–¹ä½ä¿¡æ¯ -->
        <view class="direction-row">
          <view class="direction-item">
            <view class="direction-label">å–œç¥ï¼š</view>
            <view class="direction-value">{{lunarCalendar.xishen}}</view>
          </view>
          <view class="direction-item">
            <view class="direction-label">ç¦ç¥ï¼š</view>
            <view class="direction-value">{{lunarCalendar.fushen}}</view>
          </view>
          <view class="direction-item">
            <view class="direction-label">è´¢ç¥ï¼š</view>
            <view class="direction-value">{{lunarCalendar.caishen}}</view>
          </view>
        </view>

        <!-- å†²ç…ä¿¡æ¯ -->
        <view class="chongsha-row">
          <view class="chongsha-item">
            <text class="chongsha-text">{{lunarCalendar.chong}} {{lunarCalendar.sha}}</text>
          </view>
        </view>

        <!-- æ—¶è¾°ä¿¡æ¯ -->
        <view class="time-section">
          <view class="time-row">
            <view class="time-item lucky-time">
              <view class="time-label">å‰æ—¶ï¼š</view>
              <view class="time-value">
                <text wx:for="{{lunarCalendar.jishi}}" wx:key="index" class="time-text">{{item}}</text>
              </view>
            </view>
            <view class="time-item unlucky-time">
              <view class="time-label">å‡¶æ—¶ï¼š</view>
              <view class="time-value">
                <text wx:for="{{lunarCalendar.xiongshi}}" wx:key="index" class="time-text">{{item}}</text>
              </view>
            </view>
          </view>
        </view>

        <!-- æ¯æ—¥æç¤º -->
        <view class="daily-tips">
          <view class="tips-content">{{lunarCalendar.tips}}</view>
        </view>
      </view>
    </view>
    
    <!-- AIç©¿è¡£å»ºè®® -->
    <view class="clothing-advice">
      <view class="advice-header">
        <text class="title">ä»Šæ—¥ç©¿è¡£å»ºè®®</text>
        <text class="index">æŒ‡æ•°ï¼š{{clothingAdvice.index}}</text>
      </view>
      
      <view class="advice-content">
        <view class="recommended-clothes">
          <text class="subtitle">æ¨èæ­é…</text>
          <text class="content">{{clothingAdvice.recommendation}}</text>
        </view>
        
        <view class="special-tips">
          <text class="subtitle">ç‰¹åˆ«æç¤º</text>
          <text class="content">{{clothingAdvice.tips}}</text>
        </view>
        
        <view class="zodiac-tips">
          <text class="subtitle">æ˜Ÿåº§æç¤º</text>
          <text class="content">{{clothingAdvice.zodiacAdvice}}</text>
        </view>
      </view>
    </view>
    
    <!-- æµ‹äº‹éƒ¨åˆ† -->
    <view class="divination-analysis">
      <view class="input-section">
        <view class="input-header">
          <view class="title-row">
            <text class="input-title">ä¼ç¾²å¤§æ¨¡å‹æµ‹äº‹[VIPä¸“å±]</text>
            <text class="remaining-count">ä»Šæ—¥å‰©ä½™ï¼š{{remainingCount === 'âˆ' ? 'âˆ (æ— é™åˆ¶)' : remainingCount + '/5æ¬¡'}}</text>
          </view>
          <text class="input-desc">è¯·è¾“å…¥æƒ³æµ‹çš„äº‹,å»ºè®®ä¼˜å…ˆå®Œå–„ä¸ªäººä¿¡æ¯</text>
        </view>
        <view class="input-box">
          <textarea class="matter-input" 
                    value="{{inputText}}" 
                    bindinput="onTextInput" 
                    placeholder="ä¾‹å¦‚ï¼šæˆ‘æœ€è¿‘çš„å·¥ä½œå˜åŠ¨æ˜¯å¦é¡ºåˆ©ï¼Ÿ" 
                    maxlength="100" />
          <text class="input-limit">{{inputText.length}}/100</text>
        </view>
        
        <!-- æ¨æ¼”æç¤º -->
        <view class="divination-tip">
          <text class="tip-text">æ¨æ¼”äº‹æƒ…è¿‡äºå¤æ‚çš„æƒ…å†µå¯èƒ½å› æ¨æ¼”è¶…æ—¶è€Œæ²¡æœ‰ç»“æœï¼Œå¯ä»¥å°è¯•æ¢ä¸ªé—®é¢˜</text>
        </view>
        
        <button class="submit-btn" bindtap="submitDivination">å¼€å§‹åˆ†æ</button>
        
        <!-- å†å²é—®é¢˜åˆ—è¡¨ -->
        <view class="history-section" wx:if="{{divinationHistoryList.length > 0}}">
          <view class="history-header" bindtap="toggleHistoryList">
            <text class="history-title">å†å²é—®é¢˜åˆ—è¡¨ï¼ˆ{{divinationHistoryList.length}}ï¼‰</text>
            <text class="toggle-icon">{{showHistoryList ? 'â–¼' : 'â–¶'}}</text>
          </view>
          
          <view class="history-list" wx:if="{{showHistoryList}}">
            <view class="history-item" wx:for="{{divinationHistoryList}}" wx:key="index">
              <view class="history-content" bindtap="viewHistoryResult" data-index="{{index}}">
                <view class="history-question">{{item.question}}</view>
                <view class="history-time">{{item.timeString}}</view>
              </view>
              <view class="history-actions">
                <text class="action-btn view-btn" bindtap="viewHistoryResult" data-index="{{index}}">æŸ¥çœ‹</text>
                <text class="action-btn delete-btn" bindtap="deleteHistoryItem" data-index="{{index}}">åˆ é™¤</text>
              </view>
            </view>
          </view>
        </view>
      </view>

      <view class="analysis-result" wx:if="{{divinationResult.tianshi}}">
        <!-- å¤©æ—¶åœ°åˆ©äººå’Œåˆ†æ -->
        <view class="section tiandi-section">
          <view class="section-title">å¤©æ—¶åœ°åˆ©äººå’Œ</view>
          <view class="tiandi-content">
            <view class="tiandi-item">
              <view class="tiandi-header">
                <text class="tiandi-label">å¤©æ—¶ï¼ˆ{{divinationResult.tianshi.constellation}}å®¿ï¼‰</text>
              </view>
              <text class="tiandi-analysis">{{divinationResult.tianshi.analysis}}</text>
              <text class="tiandi-influence">å½±å“ï¼š{{divinationResult.tianshi.influence}}</text>
            </view>
            
            <view class="tiandi-item">
              <view class="tiandi-header">
                <text class="tiandi-label">åœ°åˆ©ï¼ˆ{{divinationResult.dili.location}}ï¼‰</text>
              </view>
              <text class="tiandi-analysis">{{divinationResult.dili.analysis}}</text>
              <text class="tiandi-influence">é£æ°´ï¼š{{divinationResult.dili.fengshui}}</text>
            </view>
            
            <view class="tiandi-item">
              <view class="tiandi-header">
                <text class="tiandi-label">äººå’Œï¼ˆå…«å­—å‘½ç†ï¼‰</text>
              </view>
              <text class="tiandi-analysis">{{divinationResult.renhe.analysis}}</text>
              <text class="tiandi-influence">å…«å­—ï¼š{{divinationResult.renhe.bazi}}</text>
              <text class="tiandi-influence">æ€§æ ¼ï¼š{{divinationResult.renhe.personality}}</text>
            </view>
          </view>
        </view>

        <!-- ç»¼åˆå¤©æ—¶åœ°åˆ©äººå’Œåˆ†æ -->
        <view class="section comprehensive-section" wx:if="{{divinationResult.comprehensive}}">
          <view class="section-title">ç»¼åˆå¤©æ—¶åœ°åˆ©äººå’Œåˆ†æ</view>
          <view class="comprehensive-content">
            <view class="comprehensive-item">
              <text class="comprehensive-label">æ•´ä½“åˆ†æï¼š</text>
              <text class="comprehensive-text">{{divinationResult.comprehensive.tianshi_dili_renhe}}</text>
            </view>
            <view class="comprehensive-item">
              <text class="comprehensive-label">ç»¼åˆå»ºè®®ï¼š</text>
              <text class="comprehensive-text">{{divinationResult.comprehensive.overall_advice}}</text>
            </view>
            <view class="comprehensive-item">
              <text class="comprehensive-label">ååŒæ•ˆåº”ï¼š</text>
              <text class="comprehensive-text">{{divinationResult.comprehensive.synergy_effect}}</text>
            </view>
          </view>
        </view>

        <!-- å¦è±¡åˆ†æ -->
        <view class="section hexagram-section">
          <view class="section-title">ã€Šæ˜“ç»ã€‹å¦è±¡åˆ†æ</view>
          <view class="hexagram-content">
            <view class="hexagram-item">æœ¬å¦ï¼š{{divinationResult.hexagram.name}}</view>
            <view class="hexagram-desc">{{divinationResult.hexagram.description}}</view>
            <view class="hexagram-analysis">{{divinationResult.hexagram.yijing_analysis}}</view>
          </view>
        </view>

        <!-- å‘½ç†æ¼”ç®— -->
        <view class="section mingli-section">
          <view class="section-title">ä¼ ç»Ÿç»å…¸å‘½ç†æ¼”ç®—</view>
          <view class="mingli-content">
            <view class="mingli-item">
              <text class="mingli-label">ã€Šæ»´å¤©é«“ã€‹ç†è®ºï¼š</text>
              <text class="mingli-text">{{divinationResult.mingli.ditianshui_analysis}}</text>
            </view>
            <view class="mingli-item">
              <text class="mingli-label">ã€Šä¸‰å‘½é€šä¼šã€‹ç†è®ºï¼š</text>
              <text class="mingli-text">{{divinationResult.mingli.sanming_analysis}}</text>
            </view>
            <view class="mingli-item">
              <text class="mingli-label">ç»¼åˆåˆ†æï¼š</text>
              <text class="mingli-text">{{divinationResult.mingli.combined_analysis}}</text>
            </view>
          </view>
        </view>

        <!-- å‘å±•è¶‹åŠ¿ -->
        <view class="section trend-section">
          <view class="section-title">äº‹æ€å‘å±•è¶‹åŠ¿</view>
          <view class="trend-content">
            <view class="trend-item">
              <text class="trend-label">å½“å‰å½¢åŠ¿ï¼š</text>
              <text class="trend-text">{{divinationResult.trend.current}}</text>
            </view>
            <view class="trend-item">
              <text class="trend-label">çŸ­æœŸè¶‹åŠ¿ï¼ˆ1-3ä¸ªæœˆï¼‰ï¼š</text>
              <text class="trend-text">{{divinationResult.trend.short_term}}</text>
            </view>
            <view class="trend-item">
              <text class="trend-label">é•¿æœŸè¶‹åŠ¿ï¼ˆ3-12ä¸ªæœˆï¼‰ï¼š</text>
              <text class="trend-text">{{divinationResult.trend.long_term}}</text>
            </view>
            <view class="trend-item">
              <text class="trend-label">æœ€ä½³æ—¶æœºï¼š</text>
              <text class="trend-text">{{divinationResult.trend.timing}}</text>
            </view>
          </view>
        </view>

       

        <!-- åŒ–è§£æ–¹æ¡ˆ -->
        <view class="section resolution-section">
          <view class="section-title">æ³¨æ„äº‹é¡¹ä¸åŒ–è§£</view>
          <view class="resolution-content">
            <view class="challenges">
              <text class="resolution-label">æ½œåœ¨æŒ‘æˆ˜ï¼š</text>
              <view class="challenge-list">
                <text class="challenge-item" wx:for="{{divinationResult.resolution.challenges}}" wx:key="index">{{index + 1}}. {{item}}</text>
              </view>
            </view>
            <view class="solutions">
              <text class="resolution-label">åŒ–è§£æ–¹æ¡ˆï¼š</text>
              <view class="solution-list">
                <text class="solution-item" wx:for="{{divinationResult.resolution.solutions}}" wx:key="index">{{index + 1}}. {{item}}</text>
              </view>
            </view>
            <view class="alternatives">
              <text class="resolution-label">å¤‡é€‰æ–¹æ¡ˆï¼š</text>
              <view class="alternative-list">
                <text class="alternative-item" wx:for="{{divinationResult.resolution.alternative_plans}}" wx:key="index">{{index + 1}}. {{item}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view> 